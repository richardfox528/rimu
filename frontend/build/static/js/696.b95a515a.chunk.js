"use strict";(self.webpackChunkRIMU=self.webpackChunkRIMU||[]).push([[696],{1696:(e,o,a)=>{a.r(o),a.d(o,{default:()=>c});var s=a(5043),t=a(6767),r=a(6213),i=a(3574),n=a(3421),l=a(1880),d=a(579);const c=()=>{const e=(0,t.zy)(),o=(0,t.Zp)(),[a,c]=(0,s.useState)("Verifying your email..."),[u,m]=(0,s.useState)("loading"),[g,f]=(0,s.useState)(null);return(0,s.useEffect)((()=>{const a=new URLSearchParams(e.search),s=a.get("token"),t=a.get("user_id"),d=a.get("email"),u=s?s.trim().replace(/\s+/g,""):null;if(console.log("Token extracted from URL:",s),console.log("Cleaned token:",u),console.log("User ID:",t),console.log("User Email:",d),!u)return m("error"),c("You have not verified your email"),void setTimeout((()=>{o("/auth/email-verification")}),5e3);(async()=>{try{console.log("Starting verification with token:",u),console.log("User ID:",t),console.log("API URL:",(0,i.e9)("api/accounts/verify-email/"));const e={verification_code:u};t&&(e.user_id=t),d&&(e.email=d,f(d)),console.log("Clean verification data:",e);const a=await r.A.post((0,i.e9)("api/accounts/verify-email/"),e,{headers:{"Content-Type":"application/json"},timeout:1e4});if(console.log("Verification response:",a.data),!a.data.success)throw new Error(a.data.error||"Error verifying email");{m("success"),c("\xa1Email successfully verified!");let e=null,s=null;if(a.data.user&&(s=a.data.user.user_type,localStorage.setItem("userType",s),e={id:a.data.user.id,email:a.data.user.email,user_type:s},localStorage.setItem("userInfo",JSON.stringify(e))),a.data.token){const e={expires:1,path:"/",sameSite:"Lax",secure:"https:"===window.location.protocol};(0,n.TV)("token",a.data.token,1),l.A.set("token",a.data.token,e),localStorage.removeItem("token"),console.log("Token saved in cookies:",a.data.token)}const d=(0,n.Ri)("token");if(console.log("Existing token in cookies:",d),!d&&!a.data.token)return console.log("No token found - redirecting to login"),localStorage.setItem("emailVerified","true"),t&&localStorage.setItem("verifiedUserId",t),void o("/login",{state:{message:"Successful verification. Please log in to continue.",verified:!0,user_id:t}});try{const e=a.data.token||d;console.log("Token to use for info:",e);const s=await r.A.get((0,i.e9)("api/accounts/user/info/"),{headers:{Authorization:`Bearer ${e}`}});console.log("User information response:",s.data);let t=null;if(s.data&&(s.data.user?(t=s.data.user,console.log("Using data.user:",t)):s.data.id?(t=s.data,console.log("Using data directly:",t)):s.data.success&&(t=s.data.data||{},console.log("Using data.data:",t)),t&&(localStorage.setItem("userInfo",JSON.stringify(t)),console.log("Information saved in localStorage:",t),console.log("user_type:",t.user_type))),!t)throw console.warn("Could not obtain valid user information"),new Error("Invalid user data");setTimeout((()=>{if("1"===t.user_type||1===t.user_type)return void o("/company-dashboard");if("2"===t.user_type||2===t.user_type)return void o("/user-dashboard");const e=Number(t.user_type);isNaN(e)?o("/login"):o(1===e?"/company-dashboard":"/user-dashboard")}),5e3)}catch(h){console.error("Error getting user information:",h),o("/login",{state:{message:"Successful verification. Please log in to continue.",verified:!0}})}}}catch(p){var e,a,s,g;console.error("Error verifying token:",p);const r={message:p.message,response:p.response?{status:p.response.status,data:p.response.data}:"No response data",request:p.request?"Request exists":"No request data"};console.log("Error details:",JSON.stringify(r,null,2));const i=(null===(e=p.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.error)||(null===(s=p.response)||void 0===s||null===(g=s.data)||void 0===g?void 0:g.detail)||"Could not verify email. The code may be invalid or expired.";m("error"),c(i),setTimeout((()=>{o("/auth/email-verification",{state:{error:i,token:u,user_id:t}})}),5e3)}})()}),[e,o]),(0,d.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,d.jsx)("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full",children:(0,d.jsxs)("div",{className:"flex flex-col items-center",children:["loading"===u&&(0,d.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"}),"success"===u&&(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"mb-6",children:(0,d.jsx)("svg",{className:"w-16 h-16 text-green-500 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),(0,d.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"\xa1Email verificado correctamente!"}),(0,d.jsx)("p",{className:"text-gray-600 mb-4",children:"Tu cuenta ha sido verificada. Ahora puedes acceder a todas las funciones de la plataforma."}),g&&(0,d.jsxs)("div",{className:"mb-6 p-3 bg-gray-50 border border-gray-100 rounded-md",children:[(0,d.jsx)("p",{className:"text-sm text-gray-700",children:"Cuenta verificada para:"}),(0,d.jsx)("p",{className:"font-medium text-indigo-600",children:g})]}),(0,d.jsxs)("div",{className:"mt-4 py-2 px-4 bg-gray-100 rounded-md",children:[(0,d.jsx)("p",{className:"text-gray-700",children:"Redirigiendo al panel..."}),(0,d.jsx)("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2.5",children:(0,d.jsx)("div",{className:"bg-indigo-600 h-2.5 rounded-full animate-pulse w-full"})})]})]}),"error"===u&&(0,d.jsx)("svg",{className:"h-12 w-12 text-yellow-500 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,d.jsx)("h2",{className:"text-xl text-gray-700 text-center",children:a})]})})})}}}]);
//# sourceMappingURL=696.b95a515a.chunk.js.map