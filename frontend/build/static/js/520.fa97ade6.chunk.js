"use strict";(self.webpackChunkRIMU=self.webpackChunkRIMU||[]).push([[520],{9520:(e,r,t)=>{t.r(r),t.d(r,{default:()=>u});var a=t(5043),s=t(6767),i=t(6213),o=t(2115),n=t(3574),l=t(722),d=t(1880),c=(t(1686),t(579));const m=()=>{const[e,r]=(0,a.useState)("pending"),[t,m]=(0,a.useState)(""),[u,x]=(0,a.useState)(""),[h,v]=(0,a.useState)(""),[f,g]=(0,a.useState)(""),[p,y]=(0,a.useState)(""),[b,j]=(0,a.useState)(!1),[w,N]=(0,a.useState)("Verifying your email..."),[C,R]=(0,a.useState)(0),[k,A]=(0,a.useState)(""),[S,P]=(0,a.useState)(3),[E,V]=(0,a.useState)(!1),[T,M]=(0,a.useState)(""),[z,L]=(0,a.useState)(""),[H,_]=(0,a.useState)(!1),I=(0,a.useRef)(),Y=(0,s.zy)(),B=(0,s.Zp)(),[U,q]=(0,a.useState)(!1),[W,$]=(0,a.useState)(""),D=(0,a.useCallback)((()=>{q(!1),setTimeout((()=>{try{const e=parseInt(f,10);$(1===e?"Company":"User")}catch(e){$("User")}q(!0),setTimeout((()=>{try{const e=parseInt(f,10);B(1===e?"/company-dashboard":"/user-dashboard")}catch(e){B("/user-dashboard")}}),2e3)}),2e3)}),[f,B,q,$]),F=(0,a.useCallback)((async(e,t,a)=>{try{r("pending"),N("Verifying your email... Please wait.");const l=await i.A.get((0,n.e9)("api/accounts/verify-email/"),{params:{token:e,...t&&{user_id:t},...a&&{email:a}}});var s;if(l.data&&l.data.success)r("success"),l.data.user&&l.data.user.user_type&&g(l.data.user.user_type),D();else r("error"),m((null===(s=l.data)||void 0===s?void 0:s.error)||"Verification failed for an unknown reason."),o.oR.error("Verification error")}catch(f){var l,d,c,u,x,h,v;if(console.error("Error verifying email:",(null===(l=f.response)||void 0===l?void 0:l.data)||f.message),null!==(d=f.response)&&void 0!==d&&null!==(c=d.data)&&void 0!==c&&c.error&&(f.response.data.error.includes("already verified")||f.response.data.error.includes("already verified")))return r("success"),void D();r("error"),m((null===(u=f.response)||void 0===u||null===(x=u.data)||void 0===x?void 0:x.error)||"An error occurred during verification."),o.oR.error("Error: "+((null===(h=f.response)||void 0===h||null===(v=h.data)||void 0===v?void 0:v.error)||"Unknown error"))}}),[r,N,g,m,D]),Z=(0,a.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{const e=await i.A.get((0,n.e9)("api/accounts/recaptcha-key/"));L(e.data.key)}catch(r){console.error("Error getting reCAPTCHA key:",r),e<3?setTimeout((()=>{Z(e+1)}),1e3*Math.pow(2,e)):o.oR.error("Could not load security verification. Please reload the page.")}}),[]);(0,a.useEffect)((()=>{E&&!z&&Z()}),[E,z,Z]),(0,a.useEffect)((()=>{const e=new URLSearchParams(Y.search),t=e.get("token"),a=e.get("user_id")||e.get("uid"),s=e.get("email"),i=e.get("user_type");if(s)x(s),d.A.set("verificationEmail",s);else{const e=d.A.get("verificationEmail");e&&x(e)}v(a||""),g(i||""),t?(r("pending"),N("Verifying your email..."),setTimeout((()=>{F(t,a,s)}),500)):r("waiting")}),[Y,F]);const G=e=>e?/^\d{6}$/.test(e)?(A(""),!0):(A("Code must be 6 numeric digits"),!1):(A("Code is required"),!1),J=e=>{const r=e.target.value;y(r),6===r.length?G(r):A("")};(0,a.useEffect)((()=>{let e;return C>0&&(e=setInterval((()=>{R((e=>e-1))}),1e3)),()=>clearInterval(e)}),[C]);const K=async()=>{const e=u||d.A.get("verificationEmail");if(e){if(!b){j(!0);try{const t=await i.A.post((0,n.e9)("api/accounts/resend-verification-email/"),{email:e});var r;if(t.data&&t.data.success)o.oR.success("Verification email resent. Please check your inbox."),R(60);else o.oR.error((null===(r=t.data)||void 0===r?void 0:r.error)||"Error resending email")}catch(l){var t,a,s;if(429===(null===(t=l.response)||void 0===t?void 0:t.status))o.oR.error("Too many resend attempts. Please try again later.");else o.oR.error((null===(a=l.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.error)||"Error resending verification email")}finally{j(!1)}}}else o.oR.error("Could not determine your email. Please enter your email or log in again.")},O=async e=>{if(!e)return console.error("Invalid CAPTCHA token"),I.current&&I.current.reset(),void M("");try{M(e),P(3),_(!0),V(!1),o.oR.success("Verification successful. You have 3 additional attempts.")}catch(r){console.error("Error in CAPTCHA verification:",r),I.current&&I.current.reset(),M(""),o.oR.error("Verification error. Please try again."),Z()}},Q=async e=>{if(e.preventDefault(),G(p))if(!E||T){r("pending");try{const e=u||d.A.get("verificationEmail");if(!e)return void o.oR.error("Could not determine email. Please try again.");console.log("Sending verification request:",{token:p,email:e,userId:h,captchaToken:T});const s=await i.A.get((0,n.e9)("api/accounts/verify-email/"),{params:{token:p.trim(),email:e.trim(),...h&&{user_id:h},...T&&{recaptcha_token:T}}});var t,a;if(s.data&&s.data.success)r("success"),null!==(t=s.data.user)&&void 0!==t&&t.user_type&&g(s.data.user.user_type),D();else r("error"),m((null===(a=s.data)||void 0===a?void 0:a.error)||"Verification failed for an unknown reason."),o.oR.error("Verification error")}catch(x){var s;if(console.error("Verification error:",(null===(s=x.response)||void 0===s?void 0:s.data)||x),r("error"),y(""),H&&S<=1)return R(3600),m("You have exceeded the maximum number of allowed attempts. For your security, verification has been temporarily blocked."),P(0),void o.oR.error("Verification blocked for security");const e=S-1;if(P(e),!H&&e>0)m("The entered code is not valid. Please verify and try again."),o.oR.error("Incorrect code");else if(0!==e||H){var l,c;m((null===(l=x.response)||void 0===l||null===(c=l.data)||void 0===c?void 0:c.error)||"The entered code is not valid. Please verify and try again."),o.oR.error("Incorrect code")}else V(!0),m("You have used all your initial attempts. Complete the security verification to continue."),o.oR.warning("Additional verification required"),z||Z();I.current&&(I.current.reset(),M(""))}}else o.oR.warning("Please complete the security verification to continue")},X=()=>{return(0,c.jsxs)("div",{className:"mt-6 border-t pt-6",children:[(0,c.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Code verification"}),(0,c.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Enter the 6-character code you received in your email"}),(0,c.jsxs)("form",{onSubmit:Q,className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("input",{type:"text",id:"code",value:p,onChange:J,className:"w-full px-3 py-2 border rounded-md "+(k?"border-red-500":"border-gray-300"),placeholder:"Enter verification code",maxLength:6,autoFocus:!0}),k&&(0,c.jsx)("p",{className:"mt-1 text-sm text-red-600",children:k})]}),S<3&&u&&(0,c.jsxs)("div",{className:"mb-6 p-4 bg-gray-100 rounded-md",children:[(0,c.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Detected email:"}),(0,c.jsx)("p",{className:"font-medium text-indigo-600 mb-3",children:u}),(0,c.jsx)("div",{className:"mt-2",children:(0,c.jsx)("button",{type:"button",onClick:K,disabled:C>0||b,className:"w-full bg-indigo-600 text-white px-3 py-2 rounded-md hover:bg-indigo-700 "+(C>0||b?"opacity-50 cursor-not-allowed":""),children:C>0?"Resend code in "+(e=C,`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`):b?"Sending...":"Resend verification code"})})]}),E&&(0,c.jsx)("div",{className:"flex justify-center my-4",children:z?(0,c.jsx)("div",{className:"space-y-4",children:(0,c.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-4",children:[(0,c.jsxs)("div",{className:"flex items-center mb-3",children:[(0,c.jsx)("svg",{className:"h-5 w-5 text-gray-400 mr-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,c.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),(0,c.jsx)("p",{className:"text-gray-700 font-medium",children:"Security verification"})]}),(0,c.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:"Please complete the following CAPTCHA to confirm you are a person."}),(0,c.jsx)("div",{className:"flex justify-center",children:(0,c.jsx)(l.A,{ref:I,sitekey:z,onChange:O,theme:"light",size:"normal",hl:"en",onExpired:()=>{M(""),I.current&&I.current.reset(),o.oR.warning("Verification has expired. Please complete the CAPTCHA again.")},onErrored:e=>{console.error("Error in reCAPTCHA:",e),M(""),I.current&&I.current.reset(),Z(),o.oR.error("Verification error. Attempting to reload CAPTCHA...")}})})]})}):null}),0===S&&H?(0,c.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-4",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("svg",{className:"h-5 w-5 text-red-400 mr-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,c.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{className:"text-red-700 font-medium",children:"Access temporarily blocked"}),(0,c.jsx)("p",{className:"text-red-600 text-sm mt-1",children:"You have exceeded the maximum number of attempts. Please try again later."})]})]})}):0!==S||H?S>0&&H?(0,c.jsx)("div",{className:"bg-blue-50 border border-blue-200 border rounded-md p-4 mb-4",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("svg",{className:"h-5 w-5 text-blue-400 mr-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,c.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{className:"text-blue-800 font-medium",children:"Available attempts"}),(0,c.jsxs)("p",{className:"text-blue-700 text-sm mt-1",children:["You have ",S," ",1===S?"attempt":"attempts"," remaining to verify your code"]})]})]})}):null:(0,c.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-4",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("svg",{className:"h-5 w-5 text-yellow-400 mr-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,c.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{className:"text-yellow-800 font-medium",children:"Additional verification required"}),(0,c.jsx)("p",{className:"text-yellow-700 text-sm mt-1",children:"You have used all your initial attempts. Please complete the CAPTCHA."})]})]})}),(0,c.jsx)("button",{type:"submit",disabled:!!k||E&&!T&&!H||0===S&&H,className:"w-full font-medium py-2 px-4 rounded-md "+(k||E&&!T&&!H||0===S&&H?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 text-white"),children:"Verify email"})]})]});var e};return(0,c.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4 py-12",children:(0,c.jsx)("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-8",children:(()=>{switch(e){case"success":return(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("div",{className:"mb-6",children:(0,c.jsx)("svg",{className:"w-16 h-16 text-green-500 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),(0,c.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Email verified successfully!"}),(0,c.jsx)("p",{className:"text-gray-600 mb-4",children:"Your account has been verified. You can now access all platform features."}),u&&(0,c.jsxs)("div",{className:"mb-6 p-3 bg-gray-50 border border-gray-100 rounded-md",children:[(0,c.jsx)("p",{className:"text-sm text-gray-700",children:"Account verified for:"}),(0,c.jsx)("p",{className:"font-medium text-indigo-600",children:u})]}),U&&(0,c.jsxs)("div",{className:"mt-4 py-2 px-4 bg-gray-100 rounded-md",children:[(0,c.jsxs)("p",{className:"text-gray-700",children:["Redirecting to ",W," dashboard..."]}),(0,c.jsx)("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2.5",children:(0,c.jsx)("div",{className:"bg-indigo-600 h-2.5 rounded-full animate-pulse w-full"})})]})]});case"error":return(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("div",{className:"mb-6",children:(0,c.jsx)("svg",{className:"w-16 h-16 text-red-500 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),(0,c.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Verification Error"}),(0,c.jsx)("p",{className:"text-red-600 mb-4",children:t}),X(),(0,c.jsx)("div",{className:"mt-4",children:(0,c.jsx)(s.N_,{to:"/login",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Return to login"})})]});case"waiting":return(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Email Verification"}),(0,c.jsx)("p",{className:"text-gray-600 mb-6",children:"We have sent an email with a verification link and code."}),X(),(0,c.jsx)("div",{className:"mt-4",children:(0,c.jsx)(s.N_,{to:"/login",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Return to login"})})]});default:return(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mx-auto"}),(0,c.jsx)("p",{className:"mt-4 text-gray-600 mb-2",children:w||"Verifying your email..."}),u&&(0,c.jsxs)("p",{className:"text-sm text-gray-500",children:["Verifying account:"," ",(0,c.jsx)("span",{className:"font-medium",children:u})]})]})}})()})})},u=()=>(0,c.jsx)(m,{})}}]);
//# sourceMappingURL=520.fa97ade6.chunk.js.map